{% extends 'index.html' %}
{% load static %}
{% load app_filters %}
{% load mathfilters %}

{% block content %}
    <div class="card overflow-hidden mb-3">
        <div id="error-message"></div>
        <div class="bg-holder d-none d-lg-block bg-card" style="background-image:url({% static 'assets/img/illustrations/corener-4.png' %});">
        </div>
        <!--/.bg-holder-->

        <div class="card-body position-relative">
            <h6 class="text-600">Free for 30 days</h6>
            <h2>For farms of all sizes, in the cloud</h2>
            <p>Get the power, control, and customization you need to manage your<br class="d-none d-md-block" /> farmâ€™s projects.</p><a class="btn btn-link ps-0 btn-sm" href="#!"> Have questions? Chat with us</a>
        </div>
    </div>
    <div class="card mb-3">
        <div class="card-body">
            <div class="row g-0">
                <div class="col-12 mb-3">
                    <div class="row justify-content-center justify-content-sm-between">
                        <div class="col-sm-auto text-center">
                            <h5 class="d-inline-block">Billed Annually</h5>
                        </div>
                    </div>
                </div>
                {% for product in products %}
                <div class="col-lg-4 border-top border-bottom">
                    <div class="h-100">
                        <div class="text-center p-4">
                            <h3 class="fw-normal my-0">{{ product.name }}</h3>
                            {% for plan in product.plan_set.all %}
                            <p class="mt-3">{{ plan.nickname }}</p>
                            <h2 class="fw-medium my-4"> <sup class="fw-normal fs-2 me-1">{{ plan.human_readable_price }}</sup><small class="fs--1 text-700"></small>
                            </h2>
                            <button class="btn btn-primary" type="button" id="checkout-button-{{ product.id }}">
                                {% if product.name == 'Shepherd Free' %}
                                    Start your free trial
                                {% else %}
                                    Join {{ product.name }}
                                {% endif %}
                            </button>
                            {% endfor %}
                        </div>
                        <hr class="border-bottom-0 m-0" />
                        <div class="text-start px-sm-4 py-4">
                            <h5 class="fw-medium fs-0">Track team projects with free:</h5>
                            <ul class="list-unstyled mt-3">
                                <li class="py-1"><span class="me-2 fas fa-check text-success"> </span> Timeline
                                </li>
                                <li class="py-1"><span class="me-2 fas fa-check text-success"> </span> Advanced Search
                                </li>
                                <li class="py-1"><span class="me-2 fas fa-check text-success"> </span> Custom fields <div class="badge badge-soft-success rounded-pill">New</div>
                                </li>
                                <li class="py-1"><span class="me-2 fas fa-check text-success"> </span> Task dependencies
                                </li>
                                <li class="py-1"><span class="me-2 fas fa-check text-success"> </span> Private teams & projects
                                </li>
                            </ul><a class="btn btn-link" href="#">More about Single</a>
                        </div>
                    </div>
                </div>
                {% endfor %}
                {% csrf_token %}
                <div class="col-12 text-center">
                    <h5 class="mt-5">Looking for personal or small team task management?</h5>
                    <p class="fs-1">Try the <a href="#">basic version</a> of Falcon</p>
                </div>
            </div>
        </div>
    </div>
    <div class="card">
        <div class="card-header">
            <h4 class="text-center mb-0">Frequently asked questions</h4>
        </div>
        <div class="card-body bg-light">
            <h6> <a href="#!">How does Falcon's pricing work?<span class="fas fa-caret-right" data-fa-transform="right-7"></span></a></h6>
            <p class="fs--1 mb-0">The free version of Falcon is available for teams of up to 15 people. Our Falcon Premium plans of 15 or fewer qualify for a small team discount. As your team grows to 20 users or more and gets more value out of Falcon, you'll get closer to our standard monthly price per seat. The price of a paid Falcon plan is tiered, starting in groups of 5 and 10 users, based on the number of people you have in your Team or Organization.</p>
            <hr class="my-3" />
            <h6> <a href="#!">What forms of payment do you accept?<span class="fas fa-caret-right" data-fa-transform="right-7"></span></a></h6>
            <p class="fs--1 mb-0">You can purchase Falcon with any major credit card. For annual subscriptions, we can issue an invoice payable by bank transfer or check. Please contact us to arrange an invoice purchase. Monthly purchases must be paid for by credit card.</p>
            <hr class="my-3" />
            <h6> <a href="#!">We need to add more people to our team. How will that be billed?<span class="fas fa-caret-right" data-fa-transform="right-7"></span></a></h6>
            <p class="fs--1 mb-0">You can add as many new teammates as you need before changing your subscription. We will subsequently ask you to correct your subscription to cover current usage.</p>
            <hr class="my-3" />
            <h6> <a href="#!">How secure is Falcon?<span class="fas fa-caret-right" data-fa-transform="right-7"></span></a></h6>
            <p class="fs--1 mb-0">Protecting the data you trust to Falcon is our first priority. Falcon uses physical, procedural, and technical safeguards to preserve the integrity and security of your information. We regularly back up your data to prevent data loss and aid in recovery. Additionally, we host data in secure SSAE 16 / SOC1 certified data centers, implement firewalls and access restrictions on our servers to better protect your information, and work with third party security researchers to ensure our practices are secure.</p>
            <hr class="my-3" />
            <h6> <a href="#!">Will I be charged sales tax?<span class="fas fa-caret-right" data-fa-transform="right-7"></span></a></h6>
            <p class="fs--1 mb-0">As of May 2016, state and local sales tax will be applied to fees charged to customers with a billing address in the State of New York.</p>
            <hr class="my-3" />
            <h6> <a href="#!">Do you offer discounts?<span class="fas fa-caret-right" data-fa-transform="right-7"></span></a></h6>
            <p class="fs--1 mb-0">We've built in discounts at each tier for teams smaller than 15 members. We also offer two months for free in exchange for an annual subscription.</p>
            <hr class="my-3" />
            <h6> <a href="#!">Do you offer academic pricing?<span class="fas fa-caret-right" data-fa-transform="right-7"></span></a></h6>
            <p class="fs--1 mb-0">We're happy to work with student groups using Falcon. Contact Us</p>
            <hr class="my-3" />
            <h6> <a href="#!">Is there an on-premise version of Falcon?<span class="fas fa-caret-right" data-fa-transform="right-7"></span></a></h6>
            <p class="fs--1 mb-0">We are passionate about the web. We don't plan to offer an internally hosted version of Falcon. We hope you trust us to provide a robust and secure service so you can do the work only your team can do.</p>
            <hr class="my-3" />
            <h6> <a href="#!">What is your refund policy?<span class="fas fa-caret-right" data-fa-transform="right-7"></span></a></h6>
            <p class="fs--1 mb-0">We do not offer refunds apart from exceptions listed below. If you cancel your plan before the next renewal cycle, you will retain access to paid features until the end of your subscription period. When your subscription expires, you will lose access to paid features and all data associated with those features. Exceptions to our refund policy: canceling within 48 hours of initial charge will result in a full refund. If you cancel within this timeframe, you will lose access to paid features and associated data immediately upon canceling.</p>
        </div>
    </div>
    {% csrf_token %}

{% endblock %}

{% block script %}
    <script type="text/javascript">
        const csrftoken = document.querySelector('[name=csrfmiddlewaretoken]').value;
        var stripe = Stripe("{{ STRIPE_PUBLIC_KEY }}");

        {% for product in products %}
        var checkoutButton{{ product.id }} = document.getElementById("checkout-button-{{ product.id }}");
        checkoutButton{{ product.id }}.addEventListener("click", function(){
            fetch("{% url 'create-checkout-session' product=product.id %}", {
                method: "POST",
                headers: {
                    'X-CSRFToken': csrftoken
                }
            })
            .then(function (response){
                return response.json();
            })
            .then(function(session){
                return stripe.redirectToCheckout({ sessionId: session.id});
            })
            .then(function (result){
                if (result.error){
                    alert(result.error.message);
                }
            })
            .catch(function(error){
                console.error("Error:", error);
            });
        });
        {% endfor %}

    </script>
{% endblock %}